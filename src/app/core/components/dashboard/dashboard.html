<div class="level">
  <div class="level-left">
    <div>
      <h1 class="title is-2 has-text-weight-bold">Controle Financeiro</h1>
      <p class="subtitle is-6 has-text-grey">Gerencie seus gastos e acompanhe seu saldo mensal</p>
    </div>
  </div>
  <div class="level-right">
    <div class="buttons">
      <button class="ant-btn ant-btn-success">
        <i class="fas fa-plus-circle"></i> Adicionar Entrada
      </button>
      <button class="ant-btn ant-btn-primary">
        <i class="fas fa-plus"></i> Adicionar Gasto
      </button>
    </div>
  </div>
</div>

<div class="dashboard-cards">
  <!-- Cartão de saldo -->
  <div class="box balance-card">
    <div>
      <div class="card-title">SALDO DO MÊS</div>
      <div class="balance-value" [class.positive-balance]="balanceData() >= 0"
           [class.negative-balance]="balanceData() < 0">
        {{ balanceData() | currencyBrl }}
      </div>
      <div class="card-subtitle">Atualizado em {{ today | date:'dd/MM/yyyy' }}</div>
    </div>
    <div class="progress-bar">
      <div class="progress-fill progress-success" [style.width]="progressBarWidth"></div>
    </div>
    <div class="card-subtitle">{{ progressPercentage() }}% do mês decorrido</div>
  </div>

  <!-- Salário -->
  <app-summary-card
    title="SALÁRIO"
    [value]="balanceService.monthlyIncome()"
    [subtitle]="'Recebido em ' + (getSalaryDateFormatted() || 'N/A')"
    icon="money-check"
    iconBg="rgba(16, 185, 129, 0.1)"
    iconColor="#10b981">
  </app-summary-card>

  <!-- Gastos Totais -->
  <app-summary-card
    title="GASTOS TOTAIS"
    [value]="balanceService.monthlyExpenses()"
    [subtitle]="totalExpensesPercentage + '% do seu salário'"
    icon="money-bill-wave"
    iconBg="rgba(239, 68, 68, 0.1)"
    iconColor="#ef4444">
  </app-summary-card>

  <!-- Gastos Recorrentes -->
  <app-summary-card
    title="GASTOS RECORRENTES"
    [value]="balanceService.recurringExpenses()"
    [subtitle]="recurringExpensesPercentage + '% do salário'"
    icon="sync-alt"
    iconBg="rgba(245, 158, 11, 0.1)"
    iconColor="#f59e0b">
  </app-summary-card>

  <!-- Gastos Parcelados -->
  <app-summary-card
    title="GASTOS PARCELADOS"
    [value]="balanceService.installmentExpenses()"
    [subtitle]="installmentExpensesPercentage + '% do salário'"
    icon="credit-card"
    iconBg="rgba(59, 130, 246, 0.1)"
    iconColor="#3b82f6">
  </app-summary-card>
</div>

<div class="columns">
  <div class="column is-4">
    <!-- Resumo Financeiro -->
    <div class="box">
      <h2 class="title is-4">Resumo Financeiro</h2>

      <div class="summary-item">
        <span>Salário:</span>
        <span class="summary-value income-value">{{ balanceService.monthlyIncome() | currencyBrl }}</span>
      </div>

      <div class="summary-item">
        <span>Outras entradas:</span>
        <span class="summary-value income-value">R$ 0,00</span>
      </div>

      <div class="form-section-title">Gastos</div>

      <div class="summary-item">
        <span>Recorrentes:</span>
        <span class="summary-value expense-value">{{ balanceService.recurringExpenses() | currencyBrl }}</span>
      </div>

      <div class="summary-item">
        <span>Parcelados:</span>
        <span class="summary-value expense-value">{{ balanceService.installmentExpenses() | currencyBrl }}</span>
      </div>

      <div class="summary-item">
        <span>Avulsos:</span>
        <span class="summary-value expense-value">{{ balanceService.singleExpenses() | currencyBrl }}</span>
      </div>

      <div class="summary-item summary-total">
        <span>Saldo atual:</span>
        <span class="summary-value" [class.positive-balance]="balanceData() >= 0"
              [class.negative-balance]="balanceData() < 0">
          {{ balanceData() | currencyBrl }}
        </span>
      </div>

      <div class="mt-4">
        <div class="card-title">PROJEÇÃO DO SALDO</div>
        <div class="card-value positive-balance">{{ projectedBalance() | currencyBrl }}</div>
        <div class="card-subtitle">Saldo estimado no final do mês</div>
      </div>
    </div>
  </div>

  <div class="column">
    <!-- Lista de transações -->
    <app-transaction-list [transactions]="transactions()"></app-transaction-list>

    <!-- Gráfico de distribuição -->
    <div class="box">
      <h2 class="title is-4">Distribuição por Categoria</h2>
      <app-pie-chart [data]="chartData()"></app-pie-chart>
    </div>
  </div>
</div>

<!-- Seção de categorias -->
<div class="box">
  <h2 class="title is-4">Categorias</h2>
  <div class="categories-grid">
    <app-category-item
      *ngFor="let category of categories()"
      [category]="category"
      [amount]="categoryTotals()[category.id] || 0">
    </app-category-item>
  </div>
</div>
