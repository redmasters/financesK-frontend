server {
    listen 80;
    server_name localhost;

    # CORS headers for all locations
    add_header 'Access-Control-Allow-Origin' '*' always;
    add_header 'Access-Control-Allow-Methods' 'GET, POST, PUT, DELETE, OPTIONS' always;
    add_header 'Access-Control-Allow-Headers' 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,Authorization' always;
    add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;

    # Handle preflight OPTIONS requests
    if ($request_method = 'OPTIONS') {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, PUT, DELETE, OPTIONS';
        add_header 'Access-Control-Allow-Headers' 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,Authorization';
        add_header 'Access-Control-Max-Age' 1728000;
        add_header 'Content-Type' 'text/plain; charset=utf-8';
        add_header 'Content-Length' 0;
        return 204;
    }

    # Health check
    location /health {
        access_log off;
        return 200 "Backend healthy\n";
        add_header Content-Type text/plain;
    }

    # Stats endpoint - income/expense/balance with filters
    location /api/v1/transactions/stats/income-expense-balance {
        add_header Content-Type application/json;
        return 200 '{"totalIncome":7500.00,"totalExpense":2350.75,"balance":5149.25,"currency":"BRL"}';
    }

    # Search transactions with pagination and filters
    location /api/v1/transactions/search {
        add_header Content-Type application/json;
        return 200 '{"content":[{"id":1,"description":"Salario mensal","amount":5000.00,"downPayment":null,"type":"INCOME","operationType":"SALARY","status":"PAID","categoryId":2,"categoryName":"Salario","dueDate":"2025-08-15","createdAt":"2025-08-01T10:00:00Z","updatedAt":null,"notes":"Salario mensal","recurrencePattern":null,"installmentInfo":null,"userId":1,"accountId":1,"accountName":"Conta Corrente"},{"id":2,"description":"Compra parcelada - Parcela 2 de 10","amount":150.50,"downPayment":100.00,"type":"EXPENSE","operationType":"PAYMENT","status":"PENDING","categoryId":1,"categoryName":"Alimentacao","dueDate":"2025-08-20","createdAt":"2025-08-05T15:30:00Z","updatedAt":null,"notes":"Supermercado mensal","recurrencePattern":"MONTHLY","installmentInfo":{"totalInstallments":10,"currentInstallment":2,"installmentValue":15050},"userId":1,"accountId":1,"accountName":"Conta Corrente"},{"id":3,"description":"Transacao avulsa","amount":75.25,"downPayment":null,"type":"EXPENSE","operationType":"PAYMENT","status":"PAID","categoryId":3,"categoryName":"Transporte","dueDate":"2025-08-12","createdAt":"2025-08-12T08:15:00Z","updatedAt":null,"notes":"Combustivel","recurrencePattern":null,"installmentInfo":null,"userId":1,"accountId":1,"accountName":"Conta Corrente"}],"page":{"size":20,"number":0,"totalElements":3,"totalPages":1}}';
    }

    # Get transaction by ID
    location ~ ^/api/v1/transactions/([0-9]+) {
        add_header Content-Type application/json;
        return 200 '{"id":1,"description":"Salario mensal","amount":5000.00,"downPayment":null,"type":"INCOME","operationType":"SALARY","status":"PAID","categoryId":2,"categoryName":"Salario","dueDate":"2025-08-15","createdAt":"2025-08-01T10:00:00Z","updatedAt":null,"notes":"Salario mensal","recurrencePattern":null,"installmentInfo":null,"userId":1,"accountId":1,"accountName":"Conta Corrente"}';
    }

    # Create transaction (POST)
    location /api/v1/transactions {
        add_header Content-Type application/json;
        return 201 '{"id":99,"message":"Transaction created successfully","createdAt":"2025-08-16T10:30:00Z"}';
    }

    # Get all categories
    location /api/v1/categories {
        add_header Content-Type application/json;
        return 200 '[{"id":1,"name":"Alimentacao","icon":"fas fa-utensils","color":"#FF6B6B","parentId":null},{"id":2,"name":"Salario","icon":"fas fa-money-bill-wave","color":"#4ECDC4","parentId":null},{"id":3,"name":"Transporte","icon":"fas fa-car","color":"#45B7D1","parentId":null},{"id":4,"name":"Supermercado","icon":"fas fa-shopping-cart","color":"#FFA07A","parentId":1},{"id":5,"name":"Restaurante","icon":"fas fa-utensils","color":"#FFB347","parentId":1}]';
    }

    # Get category by ID
    location ~ ^/api/v1/categories/([0-9]+) {
        add_header Content-Type application/json;
        return 200 '{"id":1,"name":"Alimentacao","icon":"fas fa-utensils","color":"#FF6B6B","parentId":null}';
    }

    # Get root categories
    location /api/v1/categories/root {
        add_header Content-Type application/json;
        return 200 '[{"id":1,"name":"Alimentacao","icon":"fas fa-utensils","color":"#FF6B6B","parentId":null},{"id":2,"name":"Salario","icon":"fas fa-money-bill-wave","color":"#4ECDC4","parentId":null},{"id":3,"name":"Transporte","icon":"fas fa-car","color":"#45B7D1","parentId":null}]';
    }

    # Get categories by parent ID
    location ~ ^/api/v1/categories/parent/([0-9]+) {
        add_header Content-Type application/json;
        return 200 '[{"id":4,"name":"Supermercado","icon":"fas fa-shopping-cart","color":"#FFA07A","parentId":1},{"id":5,"name":"Restaurante","icon":"fas fa-utensils","color":"#FFB347","parentId":1}]';
    }

    # Fallback para outras rotas da API
    location /api/ {
        add_header Content-Type application/json;
        return 200 '{"message":"Mock API endpoint","timestamp":"2025-08-16T10:30:00Z"}';
    }

    # PÃ¡gina inicial
    location / {
        add_header Content-Type text/html;
        return 200 '<!DOCTYPE html><html><head><title>FinancesK Mock Backend</title></head><body><h1>FinancesK Mock Backend</h1><p>Backend simulado funcionando!</p><ul><li><a href="/api/v1/transactions/stats/income-expense-balance?userId=1">Stats Endpoint</a></li><li><a href="/api/v1/transactions/search?userId=1">Search Transactions</a></li><li><a href="/api/v1/categories">Categories</a></li><li><a href="/health">Health Check</a></li></ul></body></html>';
    }
}
